# Exploitation
### Prérequis
Disposer d'un runner github
Disposer d'une VM légère.
La VM doit avoir docker installé

Disposer/definir les variables suivantes: 

```sh
  stateProd: # exemple: terraform/prod
  IP: # IP de la machine consul`
  YOUR_SUBSCRIPTION_ID: #Id de la souscription azure
```

Disposer également des credentials du compte infiscal: https://app.infisical.com/
Générer deux clefs SSH au format RSA et stocker les dans ce Vault

## Mise en place de consul

Avant tout lancement de terraform, un serveur consul doit etre déployer afin de stocker l'état de l'infrastructure (stfate)

### Procédure

Compier le fichier "docker-compose-consul.yml" sur le serveur

Lancer le serveur:

```sh
  docker compose -f docker-compose-consul.yml up --build -d
```

Tester que le serveur est accessible
```sh
  curl http://<IP>:8500/v1/kv/?keys
```

## Les secrets AZURE


## Créer un TAG à partir de "main"